#!/usr/bin/env python3

import imp
import os

module = imp.load_source('mod_builder', os.path.join(os.path.dirname(os.path.abspath(__file__)), '..', '..', '..', 'build', 'module_builder.py'))

class Builder( module.Builder ):
#public:
	def __init__(self, name, platform, deployDir, util):
		super().__init__(name, platform, deployDir, util)

	def build(self):
		# Put tvdmodule in outDir for target
		dest = os.path.join( self.deployDir, self.module, 'node_modules', 'ioctlmodule', 'index.node' )
		self.util.deployLibrary( 'ioctlmodule', self.platform, dest )

		# Put ioctlmodule for host in src node_modules directory (for running tests)
		dstDir = os.path.join( self.moduleDir, 'node_modules', 'ioctlmodule' )
		self.util.mkdir( dstDir )
		if self.platform == 'linux':
			self.util.cp( '', dest, os.path.join( dstDir, 'index.node' ) )
		else:
			self.util.deployLibrary( 'ioctlmodule', 'linux', os.path.join( dstDir, 'index.node' ) )
