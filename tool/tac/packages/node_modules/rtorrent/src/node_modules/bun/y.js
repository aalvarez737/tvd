#!/usr/bin/env node

var stream = require("stream");

var s1 = new stream.PassThrough({objectMode: true}),
    s2 = new stream.PassThrough({objectMode: true}),
    s3 = new stream.PassThrough({objectMode: true});

var n = new stream.Writable({objectMode: true});
n._write = function _write(input, encoding, done) { done(); };

[[s1, "1"], [s2, "2"], [s3, "3"], [n, "n"]].forEach(function(p) {
  ["end", "finish", "unpipe"].forEach(function(e) {
    p[0].on(e, function() {
      console.log(p[1], e);
    });
  });
});

s1.pipe(s2).pipe(s3).pipe(s1); //pipe(n)

s1.write({hello: 1});
s2.end();
